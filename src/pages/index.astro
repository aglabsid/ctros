---
import { getCollection, getEntry } from 'astro:content'
import RootLayout from '@/layouts/root-layout.astro'
import PostCard from '@/components/post-card.astro'
import ProjectCard from '@/components/project-card.astro'

const about = await getEntry('about', 'main')
const posts = await getCollection('post')
const projects = await getCollection('project')

// Get 3 latest posts sorted by date
const latestPosts = posts
	.sort(
		(a, b) =>
			new Date(b.data.createdAt).getTime() -
			new Date(a.data.createdAt).getTime(),
	)
	.slice(0, 3)

// Get 2 latest projects sorted by position
const latestProjects = projects
	.sort((a, b) => (a.data.position ?? 999) - (b.data.position ?? 999))
	.slice(0, 2)
---

<RootLayout>
	<main class="mx-auto max-w-5xl border-x">
		<section class="border-b p-6">
			<h1 class="text-4xl">Hello, I'm {about?.data.name ?? 'there'} ðŸ‘‹</h1>
			{
				about?.data.summary && (
					<p class="mt-3 text-xl text-muted-foreground">{about.data.summary}</p>
				)
			}
		</section>

		<section class="border-b p-6">
			<div class="mb-4 flex items-center justify-between">
				<h2 class="text-2xl">Latest Blog</h2>
				<a
					href="/blog"
					class="text-base text-muted-foreground transition-colors hover:text-foreground"
				>
					View all â†’
				</a>
			</div>
			<div class="grid gap-4">
				{latestPosts.map((post) => <PostCard post={post} />)}
			</div>
			{
				latestPosts.length === 0 && (
					<p class="text-center text-muted-foreground">No posts yet.</p>
				)
			}
		</section>

		<section class="p-6">
			<div class="mb-4 flex items-center justify-between">
				<h2 class="text-2xl">Latest Works</h2>
				<a
					href="/works"
					class="text-base text-muted-foreground transition-colors hover:text-foreground"
				>
					View all â†’
				</a>
			</div>
			<div class="grid gap-4 md:grid-cols-2">
				{latestProjects.map((project) => <ProjectCard project={project} />)}
			</div>
			{
				latestProjects.length === 0 && (
					<p class="text-center text-muted-foreground">No projects yet.</p>
				)
			}
		</section>
	</main>
</RootLayout>

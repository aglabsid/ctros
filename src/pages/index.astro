---
import { getCollection, getEntry } from 'astro:content'
import RootLayout from '@/layouts/root-layout.astro'
import PostCard from '@/components/post-card.astro'

const about = await getEntry('about', 'main')
const posts = await getCollection('post')

const latestPosts = posts
	.sort(
		(a, b) =>
			new Date(b.data.createdAt).getTime() -
			new Date(a.data.createdAt).getTime(),
	)
	.slice(0, 3)
---

<RootLayout>
	<main class="mx-auto max-w-5xl border-x">
		<section class="border-b p-6">
			<h1 class="text-4xl">Hi, I'm {about?.data.name ?? 'there'} ðŸ‘‹</h1>
			{
				about?.data.summary && (
					<p class="mt-3 text-muted-foreground">{about.data.summary}</p>
				)
			}
		</section>

		<section>
			<div class="flex items-stretch border-b">
				<h2 class="px-6 py-3 text-2xl">Latest posts</h2>
				<div class="flex-1 border-l diagonal-lines"></div>
				<a
					href="/blog"
					class="flex items-center border-l px-6 text-base text-muted-foreground transition-colors hover:text-foreground"
				>
					View all â†’
				</a>
			</div>
			<div class="grid gap-4 p-6">
				{latestPosts.map((post) => <PostCard post={post} />)}
			</div>
			{
				latestPosts.length === 0 && (
					<p class="text-center text-muted-foreground">No posts yet.</p>
				)
			}
		</section>
	</main>
</RootLayout>
